<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Interactive simulation of myopia from 0 to â€“3.5 diopters." />
  <title>{{ _('â€“3.5 Myopia Simulation') }}</title>

  <!-- Inter-Font laden -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    /* ========= GLOBAL FONT ONLY ========= */
    html, body, body * {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
      font-weight: 300 !important;
      color: rgba(25, 25, 25, 0.9) !important;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-size: 10px;
      text-align: center;
      background: #eaeaea;
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: rgba(25, 25, 25, 0.9);
      text-decoration: none;
    }

    .back-link {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 0.6rem;
      text-transform: uppercase;
      opacity: 0.85;
      font-weight: 400;
      background: none;
      border: none;
      cursor: pointer;
    }

    .back-link:hover {
      text-decoration: underline;
      opacity: 1;
    }

    /* =====================================================
       LOGO SCREEN (Fade IN + OUT)
    ===================================================== */
    .logo-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #eaeaea;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;

      opacity: 0;                 /* ðŸ”¹ Start unsichtbar */
      transition: opacity 1.5s ease;
    }

    .logo-screen img {
      width: 80vw;
      max-width: 600px;
      height: auto;
    }

    /* =====================================================
       CONTENT FADE-IN (wie About / HTIF)
    ===================================================== */
    main.sim-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
      padding: 2rem 1rem;
      max-width: 800px;
      margin: auto;
      margin-top: 3rem;

      opacity: 0;
      transform: translateY(6px);
      transition: opacity 1.2s ease-out, transform 1.2s ease-out;
    }

    main.sim-container.is-visible {
      opacity: 1;
      transform: translateY(0);
    }

    .hidden { visibility: hidden; }

    main.sim-container h1 {
      font-size: 1rem;
      font-weight: 400;
      margin: 0 0 2rem 0;
    }

    .sim-img-wrapper {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .sim-img {
      width: 100%;
      max-width: 75%;
      max-height: 80vh;
      height: auto;
      object-fit: contain;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
    }

    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .progress {
      font-size: 0.8rem;
      margin-top: 0.2rem;
    }

    #stage-container {
      width: 100%;
      max-width: 500px;
    }

    #stage {
      width: 100%;
      height: 60px;
    }

    #track-inner { fill: #2c2c2c; }
    #track-fill { fill: #333; transition: width 0.3s ease; }
    #handle-inner { fill: #333; transition: cx 0.3s ease; }

    .gallery-link {
      margin-top: -0.5rem;
    }

    .gallery-link a {
      font-weight: 400;
      font-size: 0.7rem;
      padding: 0.6rem 1.2rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #eaeaea;
      transition: all 0.25s ease;
    }

    .gallery-link a:hover {
      border-color: #bbb;
    }

    /* === MOBILE BREAKPOINTS === */
    @media (max-width: 1023px) {
      main.sim-container h1 { font-size: 0.7rem; }
      .sim-img { max-width: 420px; }
      .progress { font-size: 0.5rem; }
      .logo-screen img { max-width: 480px; }
    }

    @media (max-width: 767px) {
      .sim-img { max-width: 360px; }
      #stage { height: 55px; width: 50%; }
    }

    @media (max-width: 480px) {
      .sim-img { max-width: 340px; }
    }

    /* --- enable slider interaction (no visual change) --- */
#stage {
  pointer-events: auto;
  touch-action: none;
}

#track-inner,
#track-fill,
#handle-inner {
  pointer-events: all;
}
  </style>
</head>

<body>

  <a href="/" class="back-link">{{ _('Back') }}</a>

  <div class="logo-screen" id="logoScreen" aria-hidden="true">
    <img src="/static/projects/drei_komma_5/img/logos/-3.5_LOGO.png" alt="{{ _('Logo') }}">
  </div>

  <main class="sim-container hidden" id="simContent">
    <h1>{{ _('How I See â€“ Myopia Simulation (0 to -3.5 dpt)') }}</h1>

    <div class="sim-img-wrapper">
      <img id="myopieImage"
           src="/static/projects/drei_komma_5/img/simulation/Hand/desktop/sim_IMG_8001_prep_for_sim_0.0dpt_16bit.jpg"
           class="sim-img">
    </div>

    <section class="controls">
      <div id="stage-container">
        <div class="progress"><span id="progress-value">0.0</span> dpt</div>
        <svg id="stage" viewBox="0 0 600 10">
          <rect id="track-inner" x="20" y="3" width="560" height="1"/>
          <rect id="track-fill" x="20" y="3" width="0" height="1"/>
          <circle id="handle-inner" cx="20" cy="5" r="3"/>
        </svg>
      </div>
    </section>

    <footer class="gallery-link">
      <a href="{{ url_for('gallery_preview') }}">{{ _('Gallery') }}</a>
    </footer>
  </main>

  <script>
    const image = document.getElementById("myopieImage");
    const progressText = document.getElementById("progress-value");
    const handle = document.getElementById("handle-inner");
    const trackFill = document.getElementById("track-fill");

    const steps = ["0.0","0.5","1.0","1.5","2.0","2.5","3.0","3.5"];
    const trackStart = 20;
    const trackEnd = 580;
    const stepWidth = (trackEnd - trackStart) / (steps.length - 1);
    let currentStep = 0;

    function updateVisual() {
      const cx = trackStart + currentStep * stepWidth;
      handle.setAttribute("cx", cx);
      trackFill.setAttribute("width", cx - trackStart);
      progressText.textContent = steps[currentStep] === "0.0" ? "0.0" : `â€“${steps[currentStep]}`;
      image.src = `/static/projects/drei_komma_5/img/simulation/Hand/desktop/sim_IMG_8001_prep_for_sim_${steps[currentStep]}dpt_16bit.jpg`;
    }

    window.addEventListener("load", () => {
      const logo = document.getElementById("logoScreen");
      const content = document.getElementById("simContent");

      /* ðŸ”¹ Logo sanft einblenden */
      requestAnimationFrame(() => { logo.style.opacity = "1"; });

      setTimeout(() => {
        logo.style.opacity = "0";
        setTimeout(() => {
          logo.style.display = "none";
          content.classList.remove("hidden");
          requestAnimationFrame(() => content.classList.add("is-visible"));
          updateVisual();
        }, 1500);
      }, 2000);
    });

      /* --- slider interaction only (no behavior change) --- */
  const stage = document.getElementById("stage");
  let dragging = false;

  function setStepFromClientX(clientX) {
    const rect = stage.getBoundingClientRect();
    const scale = 600 / rect.width;   // viewBox width / CSS width
    let x = (clientX - rect.left) * scale;
    x = Math.max(trackStart, Math.min(trackEnd, x));
    currentStep = Math.round((x - trackStart) / stepWidth);
    updateVisual();
  }

  /* Mouse */
  stage.addEventListener("mousedown", e => {
    dragging = true;
    setStepFromClientX(e.clientX);
  });

  window.addEventListener("mousemove", e => {
    if (dragging) setStepFromClientX(e.clientX);
  });

  window.addEventListener("mouseup", () => {
    dragging = false;
  });

  /* Touch */
  stage.addEventListener("touchstart", e => {
    dragging = true;
    setStepFromClientX(e.touches[0].clientX);
  }, { passive: false });

  window.addEventListener("touchmove", e => {
    if (dragging) setStepFromClientX(e.touches[0].clientX);
  }, { passive: false });

  window.addEventListener("touchend", () => {
    dragging = false;
  });
  </script>

</body>
</html>
